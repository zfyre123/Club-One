tribe.events=tribe.events||{};tribe.events.views=tribe.events.views||{};tribe.events.views.eventsBar={};(function($,obj){'use strict';var $document=$(document);obj.selectors={eventsBar:'[data-js="tribe-events-events-bar"]',tabList:'[data-js="tribe-events-events-bar-tablist"]',tab:'[data-js~="tribe-events-events-bar-tab"]',tabPanel:'[data-js~="tribe-events-events-bar-tabpanel"]',searchButton:'[data-js="tribe-events-search-button"]',searchButtonActiveClass:'.tribe-events-c-events-bar__search-button--active',filtersButton:'[data-js="tribe-events-filters-button"]',searchFiltersContainer:'[data-js="tribe-events-search-filters-container"]',filtersContainer:'[data-js~="tribe-events-events-bar-filters"]',hasFilterBarClass:'.tribe-events-c-events-bar--has-filter-bar',activeTabClass:'.tribe-events-c-events-bar__tab--active',};obj.keyCode={END:35,HOME:36,LEFT:37,RIGHT:39,};obj.deselectTabs=function(tabs){tabs.forEach(function($tab){$tab.attr('tabindex','-1').attr('aria-selected','false').removeClass(obj.selectors.activeTabClass.className());});};obj.hideTabPanels=function(tabPanels){tabPanels.forEach(function($tabPanel){$tabPanel.prop('hidden',true);});};obj.selectTab=function(tabs,tabPanels,$tab,$container){obj.deselectTabs(tabs);obj.hideTabPanels(tabPanels);$tab.attr('aria-selected','true').removeAttr('tabindex').addClass(obj.selectors.activeTabClass.className()).focus();$container.find('#'+$tab.attr('aria-controls')).removeProp('hidden');};obj.getCurrentTab=function(tabs){var currentTab;tabs.forEach(function($tab,index){if($tab.is(document.activeElement)){currentTab=index;}});return currentTab;};obj.handleTabClick=function(event){var $container=$(event.data.container);var $eventsBar=$container.find(obj.selectors.eventsBar);var state=$eventsBar.data('tribeEventsState');var tabs=state.tabs;var tabPanels=state.tabPanels;var selectedTab=$(event.target).closest(obj.selectors.tab);obj.selectTab(tabs,tabPanels,selectedTab,$container);};obj.handleTabKeydown=function(event){var key=event.which||event.keyCode;var $container=$(event.data.container);var $eventsBar=$container.find(obj.selectors.eventsBar);var state=$eventsBar.data('tribeEventsState');var tabs=state.tabs;var tabPanels=state.tabPanels;var currentTab=obj.getCurrentTab(tabs);var nextTab;switch(key){case obj.keyCode.LEFT:nextTab=0===currentTab?tabs.length-1:currentTab-1;break;case obj.keyCode.RIGHT:nextTab=tabs.length-1===currentTab?0:currentTab+1;break;case obj.keyCode.HOME:nextTab=0;break;case obj.keyCode.END:nextTab=tabs.length-1;break;default:return;}
obj.selectTab(tabs,tabPanels,tabs[nextTab],$container);event.preventDefault();};obj.deinitTablist=function($container){$container.find(obj.selectors.tab).each(function(index,tab){$(tab).removeAttr('aria-selected').removeAttr('tabindex').off();});$container.find(obj.selectors.tabPanel).each(function(index,tabpanel){$(tabpanel).removeAttr('role').removeAttr('aria-labelledby').removeProp('hidden');});};obj.initTablist=function($container){var $eventsBar=$container.find(obj.selectors.eventsBar);var state=$eventsBar.data('tribeEventsState');var tabs=[];var tabpanels=[];$container.find(obj.selectors.tab).each(function(index,tab){var $tab=$(tab);var $tabpanel=$container.find('#'+$tab.attr('aria-controls'));$tab.attr('aria-selected','true').on('keydown',{container:$container},obj.handleTabKeydown).on('click',{container:$container},obj.handleTabClick);$tabpanel.attr('role','tabpanel').attr('aria-labelledby',$tab.attr('id'));if(index!==0){$tab.attr('tabindex','-1');$tabpanel.prop('hidden',true);}
tabs.push($tab);tabpanels.push($tabpanel);});state.tabs=tabs;state.tabPanels=tabpanels;$eventsBar.data('tribeEventsState',state);};obj.deinitAccordion=function($header,$content){tribe.events.views.accordion.deinitAccordion(0,$header);tribe.events.views.accordion.deinitAccordionA11yAttrs($header,$content);$content.css('display','');};obj.initAccordion=function($container,$header,$content){tribe.events.views.accordion.initAccordion($container)(0,$header);tribe.events.views.accordion.initAccordionA11yAttrs($header,$content);};obj.deinitFiltersAccordion=function($container){var $filtersButton=$container.find(obj.selectors.filtersButton);if($filtersButton.length){var $filtersContainer=$container.find(obj.selectors.filtersContainer);obj.deinitAccordion($filtersButton,$filtersContainer);}};obj.initFiltersAccordion=function($container){var $filtersButton=$container.find(obj.selectors.filtersButton);if($filtersButton.length){var $filtersContainer=$container.find(obj.selectors.filtersContainer);obj.initAccordion($container,$filtersButton,$filtersContainer);}};obj.handleSearchButtonClick=function(event){event.data.target.toggleClass(obj.selectors.searchButtonActiveClass.className());};obj.deinitSearchAccordion=function($container){var $searchButton=$container.find(obj.selectors.searchButton);$searchButton.removeClass(obj.selectors.searchButtonActiveClass.className());var $searchFiltersContainer=$container.find(obj.selectors.searchFiltersContainer);obj.deinitAccordion($searchButton,$searchFiltersContainer);$searchButton.off('click',obj.handleSearchButtonClick);};obj.initSearchAccordion=function($container){var $searchButton=$container.find(obj.selectors.searchButton);var $searchFiltersContainer=$container.find(obj.selectors.searchFiltersContainer);obj.initAccordion($container,$searchButton,$searchFiltersContainer);$searchButton.on('click',{target:$searchButton},obj.handleSearchButtonClick);};obj.initState=function($container){var $eventsBar=$container.find(obj.selectors.eventsBar);var state={mobileInitialized:false,desktopInitialized:false,tabs:[],tabPanels:[],currentTab:0,};$eventsBar.data('tribeEventsState',state);};obj.deinitEventsBar=function($container){obj.deinitTablist($container);obj.deinitFiltersAccordion($container);obj.deinitSearchAccordion($container);};obj.initEventsBar=function($container){var $eventsBar=$container.find(obj.selectors.eventsBar);if($eventsBar.length){var state=$eventsBar.data('tribeEventsState');var $filtersButton=$container.find(obj.selectors.filtersButton);var containerState=$container.data('tribeEventsState');var isMobile=containerState.isMobile;if(isMobile&&!state.mobileInitialized){if($filtersButton.length){obj.initTablist($container);obj.deinitFiltersAccordion($container);}
obj.initSearchAccordion($container);state.desktopInitialized=false;state.mobileInitialized=true;$eventsBar.data('tribeEventsState',state);}else if(!isMobile&&!state.desktopInitialized){if($filtersButton.length){obj.deinitTablist($container);obj.initFiltersAccordion($container);}
obj.deinitSearchAccordion($container);state.mobileInitialized=false;state.desktopInitialized=true;$eventsBar.data('tribeEventsState',state);}}};obj.handleResize=function(event){obj.initEventsBar(event.data.container);};obj.handleClick=function(event){var $target=$(event.target);var isParentSearchButton=Boolean($target.closest(obj.selectors.searchButton).length);var isParentSearchFiltersContainer=Boolean($target.closest(obj.selectors.searchFiltersContainer).length);if(!(isParentSearchButton||isParentSearchFiltersContainer)){var $container=event.data.container;var $eventsBar=$container.find(obj.selectors.eventsBar);var $searchButton=$eventsBar.find(obj.selectors.searchButton);if($searchButton.hasClass(obj.selectors.searchButtonActiveClass.className())){var $searchFiltersContainer=$eventsBar.find(obj.selectors.searchFiltersContainer);$searchButton.removeClass(obj.selectors.searchButtonActiveClass.className());tribe.events.views.accordion.closeAccordion($searchButton,$searchFiltersContainer);}}};obj.unbindEvents=function($container){$container.off('resize.tribeEvents',obj.handleResize);$document.off('click',obj.handleClick);};obj.bindEvents=function($container){$container.on('resize.tribeEvents',{container:$container},obj.handleResize);$document.on('click',{container:$container},obj.handleClick);};obj.deinit=function(event,jqXHR,settings){var $container=event.data.container;obj.deinitEventsBar($container);obj.unbindEvents($container);$container.off('beforeAjaxSuccess.tribeEvents',obj.deinit);};obj.init=function(event,index,$container,data){var $eventsBar=$container.find(obj.selectors.eventsBar);if(!$eventsBar.length){return;}
obj.initState($container);obj.initEventsBar($container);obj.bindEvents($container);$container.on('beforeAjaxSuccess.tribeEvents',{container:$container},obj.deinit);};obj.ready=function(){$document.on('afterSetup.tribeEvents',tribe.events.views.manager.selectors.container,obj.init);};$document.ready(obj.ready);})(jQuery,tribe.events.views.eventsBar);